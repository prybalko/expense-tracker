{{define "content"}}
<div class="fixed inset-0 w-full h-full flex flex-col z-50 font-sans" style="background: var(--pico-background-color);">
    <!-- Header -->
    <header class="flex justify-between items-center p-4">
        <button 
            hx-get="/expenses" 
            hx-target="#content"
            hx-push-url="true"
            class="text-2xl text-gray"
            style="background: none; border: none; padding: 0.5rem;"
        >√ó</button>
    </header>

    <form 
        hx-post="/expenses" 
        hx-target="#content"
        class="flex flex-col h-full"
    >
        <!-- Amount Display -->
        <div class="flex-1 flex justify-center items-center relative">
            <div class="amount-display">
                <span class="tracking-tighter">‚Ç¨</span>
                <input 
                    type="number" 
                    name="amount" 
                    step="0.01" 
                    placeholder="0.00" 
                    required
                    class="amount-input"
                    autofocus
                >
            </div>
        </div>

        <!-- Add Note -->
        <div class="flex justify-center mb-8">
            <input 
                type="text" 
                name="description" 
                placeholder="Add Note"
                style="text-align: center; border-radius: 9999px; max-width: 200px;"
            >
        </div>

        <!-- Bottom Section -->
        <div class="pb-6 px-4">
            <!-- Actions Row -->
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div class="relative">
                    <input 
                        type="datetime-local" 
                        name="date"
                        id="date-input"
                        class="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer"
                        onchange="window.updateDateDisplay(this)"
                    >
                    <div role="button" class="secondary outline w-full flex items-center justify-center gap-2" style="margin-bottom: 0;">
                        <span>üìÖ</span> <span id="date-display">Today</span>
                    </div>
                </div>
                
                <div class="relative">
                     <select 
                        name="category" 
                        class="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer"
                        onchange="updateCategoryDisplay(this)"
                    >
                        <option value="food" selected>Food</option>
                        <option value="transport">Transport</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="utilities">Utilities</option>
                        <option value="housing">Housing</option>
                        <option value="gifts">Gifts</option>
                        <option value="other">Other</option>
                    </select>
                    <div role="button" class="secondary outline w-full flex items-center justify-center gap-2" style="margin-bottom: 0;">
                        <span>üçΩÔ∏è</span> <span id="category-display">Food</span>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
             <button 
                type="submit"
                class="w-full contrast"
                style="height: 4rem; font-size: 1.25rem; border-radius: 0.75rem;"
            >
                Save Expense
            </button>
        </div>
    </form>

    <script>
        (function() {
            function updateDateDisplay(input) {
                const date = new Date(input.value || new Date());
                const now = new Date();
                const isToday = date.toDateString() === now.toDateString();
                
                const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateStr = isToday ? 'Today' : date.toLocaleDateString(undefined, { day: 'numeric', month: 'short' });
                
                document.getElementById('date-display').textContent = `${dateStr}, ${timeStr}`;
            }
            
            // Initialize date input with local ISO string
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            const dateInput = document.getElementById('date-input');
            
            if (dateInput) {
                dateInput.value = now.toISOString().slice(0, 16);
                updateDateDisplay(dateInput);
                
                // Expose click handler for the container to trigger the input picker
                window.triggerDatePicker = function() {
                    if (dateInput.showPicker) {
                        dateInput.showPicker();
                    } else {
                        dateInput.click();
                    }
                }
            }

            const categoryIcons = {
                'food': 'üçΩÔ∏è',
                'transport': 'üöå',
                'entertainment': 'üéÆ',
                'utilities': 'üí°',
                'housing': 'üè†',
                'gifts': 'üéÅ',
                'other': 'üì¶'
            };

            window.updateCategoryDisplay = function(select) {
                const category = select.value;
                const icon = categoryIcons[category] || 'üì¶';
                const display = document.getElementById('category-display');
                display.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                display.previousElementSibling.textContent = icon;
            };

            window.updateDateDisplay = updateDateDisplay;
        })();
    </script>
</div>
{{end}}
